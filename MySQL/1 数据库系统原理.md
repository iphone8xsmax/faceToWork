[TOC]

### 数据库系统原理

#### 函数依赖

记 **A->B** 表示 **A 函数决定 B**，也可以说 **B 函数依赖于 A**。

如果 {A1，A2，... ，An} 是关系的一个或多个属性的集合，该集合函数决定了关系的其它所有属性并且是最小的，那么该集合就称为**键码**。

对于 A->B，如果能找到 A 的真子集 A'，使得 A'-> B，那么 A->B 就是**部分函数依赖**，否则就是**完全函数依赖**。

对于 A->B，B->C，则 A->C 是一个**传递函数依赖**。



#### 异常

以下的学生课程关系的函数依赖为 {Sno, Cname} -> {Sname, Sdept, Mname, Grade}，**键码为 {Sno, Cname}**。也就是说，确定**学生和课程**之后，就能确定其它信息。

| Sno  | Sname  | Sdept  | Mname  | Cname  | Grade |
| :--: | :----: | :----: | :----: | :----: | :---: |
|  1   | 学生-1 | 学院-1 | 院长-1 | 课程-1 |  90   |
|  2   | 学生-2 | 学院-2 | 院长-2 | 课程-2 |  80   |
|  2   | 学生-2 | 学院-2 | 院长-2 | 课程-1 |  100  |
|  3   | 学生-3 | 学院-2 | 院长-2 | 课程-2 |  95   |

不符合范式的关系，会产生很多**异常**，主要有以下四种异常：

- **冗余数据**：例如 `学生-2` 出现了两次。
- **修改异常**：修改了一个记录中的信息，但是另一个记录中相同的信息却没有被修改。
- **删除异常**：删除一个信息，那么也会丢失其它信息。例如删除了 `课程-1` 需要删除第一行和第三行，那么 `学生-1` 的信息就会丢失。
- **插入异常**：例如想要插入一个学生的信息，如果这个学生还没选课，那么就无法插入。



#### 范式

- 1NF：属性不可分 
- 2NF：属性完全依赖于主键 [消除部分子函数依赖] 
- 3NF：属性不依赖于其它非主属性 [消除传递依赖] 
- BCNF（巴斯-科德范式）：在1NF基础上，任何非主属性不能对主键子集依赖[在3NF基础上消除对主码子集的依赖] 
- 4NF：要求把同一表内的多对多关系删除。 
- 5NF（完美范式）：从最终结构重新建立原始结构。 

范式理论是为了解决以上提到**四种异常**。

高级别范式的依赖于低级别的范式，1NF 是最低级别的范式。

##### 1. 第一范式 (1NF)

**属性不可分。**

##### 2. 第二范式 (2NF)

每个**非主属性**完全函数依赖于键码。

可以通过**分解**来满足。

**分解前**

| Sno  | Sname  | Sdept  | Mname  | Cname  | Grade |
| :--: | :----: | :----: | :----: | :----: | :---: |
|  1   | 学生-1 | 学院-1 | 院长-1 | 课程-1 |  90   |
|  2   | 学生-2 | 学院-2 | 院长-2 | 课程-2 |  80   |
|  2   | 学生-2 | 学院-2 | 院长-2 | 课程-1 |  100  |
|  3   | 学生-3 | 学院-2 | 院长-2 | 课程-2 |  95   |

以上学生课程关系中，{Sno, Cname} 为**键码**，有如下函数依赖：

- Sno -> Sname, Sdept
- Sdept -> Mname
- Sno, Cname-> Grade

可以发现，**Grade 完全函数依赖于键码**，它没有任何冗余数据，每个学生的每门课都有特定的成绩。

Sname, Sdept 和 Mname 都**部分依赖**于键码，当一个学生选修了多门课时，这些数据就会出现多次，造成大量**冗余数据**。

**分解后**

关系-1

| Sno  | Sname  | Sdept  | Mname  |
| :--: | :----: | :----: | :----: |
|  1   | 学生-1 | 学院-1 | 院长-1 |
|  2   | 学生-2 | 学院-2 | 院长-2 |
|  3   | 学生-3 | 学院-2 | 院长-2 |

有以下函数依赖：

- Sno -> Sname, Sdept
- Sdept -> Mname

关系-2

| Sno  | Cname  | Grade |
| :--: | :----: | :---: |
|  1   | 课程-1 |  90   |
|  2   | 课程-2 |  80   |
|  2   | 课程-1 |  100  |
|  3   | 课程-2 |  95   |

有以下函数依赖：

- Sno, Cname ->  Grade

##### 3. 第三范式 (3NF)

**非主属性不传递函数依赖于键码。**

上面的 关系-1 中存在以下**传递函数依赖**：

- Sno -> Sdept -> Mname

可以进行以下**分解**：

关系-11

| Sno  | Sname  | Sdept  |
| :--: | :----: | :----: |
|  1   | 学生-1 | 学院-1 |
|  2   | 学生-2 | 学院-2 |
|  3   | 学生-3 | 学院-2 |

关系-12

| Sdept  | Mname  |
| :----: | :----: |
| 学院-1 | 院长-1 |
| 学院-2 | 院长-2 |



#### ER 图

Entity-Relationship，有三个组成部分：**实体、属性、联系**。

用来进行**关系型**数据库系统的概念设计。

##### 1. 实体的三种联系

包含**一对一，一对多，多对多**三种。

- 如果 A 到 B 是**一对多**关系，那么画个**带箭头**的线段指向 B；
- 如果是一对一，画两个带箭头的线段；
- 如果是多对多，画两个不带箭头的线段。

下图的 Course 和 Student 是**一对多**的关系。

![image-20200417150541977](assets/image-20200417150541977.png)

##### 2. 表示出现多次的关系

一个实体在联系出现**几次**，就要用**几条线**连接。

下图表示一个课程的先修关系，先修关系出现两个 Course 实体，第一个是**先修课程**，后一个是**后修课程**，因此需要用两条线来表示这种关系。

![image-20200417150704398](assets/image-20200417150704398.png)

##### 3. 联系的多向性

虽然老师可以开设多门课，并且可以教授多名学生，但是对于特定的学生和课程，只有一个老师教授，这就构成了一个**三元联系**。

![image-20200417150815381](assets/image-20200417150815381.png)

##### 4. 表示子类

用一个**三角形和两条线来连接类和子类**，与子类有关的**属性**和联系都连到子类上，而与**父类和子类都有关的连到父类**上。

![image-20200417150829899](assets/image-20200417150829899.png)





#### 参考资料

- AbrahamSilberschatz, HenryF.Korth, S.Sudarshan, 等. 数据库系统概念 [M]. 机械工业出版社, 2006.
- 施瓦茨. 高性能 MYSQL(第3版)[M]. 电子工业出版社, 2013.
- 史嘉权. 数据库系统概论[M]. 清华大学出版社有限公司, 2006.